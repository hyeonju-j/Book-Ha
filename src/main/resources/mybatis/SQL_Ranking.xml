<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bookha.main.mapper.Mapper_Ranking">
	
	<!-- 오늘 날짜 출석체크 여부 확인 -->
	<select id="check_attendance" parameterType="int" resultType="int">
		SELECT EXISTS(
			SELECT
				at_login
			FROM
				attendance
			WHERE
				at_num = ${user_num}
			AND
				DATE(at_login)=DATE(now())
		)AS flag
	</select>
	
	<!-- 출석체크 도장을 찍을 때 -->
	<insert id="add_attendance" parameterType="int">
		INSERT INTO
			attendance
		VALUES (
			0, ${user_num}, now()
		)
	</insert>

    <select id="review_ranking" resultType="com.bookha.main.dto.DTO_Review_Board">
		SELECT
			re_num as user_num,
			count(*) count, 
			max(re_date) last_wdate 
		FROM 
			review_board 
		INNER JOIN 
			tb_user
		ON
			re_num = user_num
		GROUP BY 
			re_num 
		ORDER BY
			count desc, 
			re_date desc 
		LIMIT 0,3;
    </select>
    
    <select id="album_ranking" resultType="com.bookha.main.dto.DTO_Album_Board">
		SELECT
			al_user_num,
			count(*) count, 
			max(al_wdate) last_wdate 
		FROM 
			album_board 
		INNER JOIN 
			tb_user
		ON
			al_user_num = user_num
		GROUP BY 
			al_user_num 
		ORDER BY
			count desc, 
			al_wdate desc 
		LIMIT 0,3;
    </select>
    
    <select id="share_ranking" resultType="com.bookha.main.dto.DTO_Share_Board">
		SELECT
			sh_num as user_num,
			count(*) count, 
			max(sh_date) last_wdate 
		FROM 
			share_board 
		INNER JOIN 
			tb_user
		ON
			sh_num = user_num
		GROUP BY 
			sh_num 
		ORDER BY
			count desc, 
			sh_date desc
		LIMIT 0,3;
    </select>
    
    <select id="get_profile" parameterType="int" resultType="com.bookha.main.dto.DTO_User">
    	SELECT
    		user_num,
    		user_nickname,
    		user_profile
    	FROM
    		TB_USER
    	WHERE
    		user_num = ${user_num}
    		
    </select>

</mapper>